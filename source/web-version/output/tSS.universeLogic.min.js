Bridge.assembly("TSS.SharpedJs",function($asm){"use strict";Bridge.define("TSS.UniverseLogic.IHasEnergy",{$kind:"interface"});Bridge.define("TSS.UniverseLogic.UniverseObject",{inherits:[System.IDisposable],descriptor:0,x:-1,y:-1,constsUniverse:null,config:{alias:["dispose","System$IDisposable$dispose"]},ctor:function(constsUniverse){this.$initialize();this.setConstsUniverseProperty(constsUniverse)},getConstsUniverseProperty:function(){return this.constsUniverse},setConstsUniverseProperty:function(value){this.constsUniverse=value},setCords:function(x,y){this.x=x;this.y=y},getX:function(){return this.x},getY:function(){return this.y},getDescriptor:function(){return this.descriptor},dispose:function(){this.descriptor=0},isDisposed:function(){return this.descriptor===0}});Bridge.define("TSS.UniverseLogic.Cell.LinkedInt",{value:1});Bridge.define("TSS.UniverseLogic.ConstsUniverse",{maxCountOfCellTypes:10,mutation_Enable:!0,mutation_AttackChildrenMutantsOfFirstGeneration:!1,mutation_AttackParentIfCellIsYouMutant:!1,mutation_ChangedValuesAtOne:1,mutation_ChancePercent:10,cellAge_Max:99999,cellAge_AdultCell:25,energyLevel_CreatingCell:125,energyLevel_NeededForReproduction:100,energyLevel_MaxForCell:1e3,energyLevel_DeadCell:20,energyLevel_DefFood:10,energyLevel_PoisonedFood:-10,energyLevel_MovesFriendly:1,energyLevel_MovesAggression:5,cellsCount_MaxWithOneType:9e3,cellGenome_Child_Aggression:-2,cellsCount_MaxAtField:250,energyEntropyPerSecond:1,special_FoodCountForTick:2,special_PoisonCountForTick:2,cellGenome_HungerRange:null,cellGenome_AggressionRange:null,cellGenome_ReproductionRange:null,cellGenome_FriendlyRange:null,cellGenome_PoisonRange:null,cellGenome_CorpseRange:null,config:{init:function(){this.cellGenome_HungerRange=new TSS.Helpers.MinMaxInt.$ctor1(-10,10);this.cellGenome_AggressionRange=new TSS.Helpers.MinMaxInt.$ctor1(-10,10);this.cellGenome_ReproductionRange=new TSS.Helpers.MinMaxInt.$ctor1(-10,10);this.cellGenome_FriendlyRange=new TSS.Helpers.MinMaxInt.$ctor1(-10,10);this.cellGenome_PoisonRange=new TSS.Helpers.MinMaxInt.$ctor1(-10,10);this.cellGenome_CorpseRange=new TSS.Helpers.MinMaxInt.$ctor1(-10,10)}},ctor:function(){this.$initialize()},getCellGenome_Hunger:function(){return this.randomFromRange(this.cellGenome_HungerRange.min,this.cellGenome_HungerRange.max)},getCellGenome_Aggression:function(){return this.randomFromRange(this.cellGenome_AggressionRange.min,this.cellGenome_AggressionRange.max)},getCellGenome_Reproduction:function(){return this.randomFromRange(this.cellGenome_ReproductionRange.min,this.cellGenome_ReproductionRange.max)},getCellGenome_Friendly:function(){return this.randomFromRange(this.cellGenome_FriendlyRange.min,this.cellGenome_FriendlyRange.max)},getCellGenome_PoisonAddiction:function(){return this.randomFromRange(this.cellGenome_PoisonRange.min,this.cellGenome_PoisonRange.max)},getCellGenome_CorpseAddiction:function(){return this.randomFromRange(this.cellGenome_CorpseRange.min,this.cellGenome_CorpseRange.max)},saveToFile:function(){},randomFromRange:function(minValue,maxValue){return minValue>=maxValue?minValue:TSS.Another.StableRandom.rd.next$2(minValue,maxValue)}});Bridge.define("TSS.UniverseLogic.FoodType",{$kind:"enum",statics:{poison:0,deadCell:1,defaultFood:2}});Bridge.define("TSS.UniverseLogic.Genome",{hunger:0,aggression:0,reproduction:0,friendly:0,poisonAddiction:0,corpseAddiction:0,ctor:function(hunger,aggression,reproduction,friendly,poisonAddiction,corpseAddiction){this.$initialize();this.hunger=hunger;this.aggression=aggression;this.reproduction=reproduction;this.friendly=friendly;this.poisonAddiction=poisonAddiction;this.corpseAddiction=corpseAddiction},$ctor1:function(constsUniverse){TSS.UniverseLogic.Genome.ctor.call(this,constsUniverse.getCellGenome_Hunger(),constsUniverse.getCellGenome_Aggression(),constsUniverse.getCellGenome_Reproduction(),constsUniverse.getCellGenome_Friendly(),constsUniverse.getCellGenome_PoisonAddiction(),constsUniverse.getCellGenome_CorpseAddiction())},getHunger:function(){return this.hunger},getAggression:function(){return this.aggression},getReproduction:function(){return this.reproduction},getFriendly:function(){return this.friendly},getPoisonAddiction:function(){return this.poisonAddiction},getCorpseAddiction:function(){return this.corpseAddiction},clone:function(){return new TSS.UniverseLogic.Genome.ctor(this.hunger,this.aggression,this.reproduction,this.friendly,this.poisonAddiction,this.corpseAddiction)},cloneAndMutate:function(Mutation_ChangedValuesAtOne){for(var modificator,hunger=this.hunger,aggression=this.aggression,reproduction=this.reproduction,friendly=this.friendly,i=0;i<Mutation_ChangedValuesAtOne;i=i+1|0){modificator=TSS.Another.StableRandom.rd.next$1(2)===0?-1:1;switch(TSS.Another.StableRandom.rd.next$2(1,7)){case 1:hunger=hunger+modificator|0;break;case 2:aggression=aggression+modificator|0;break;case 3:reproduction=reproduction+modificator|0;break;case 4:friendly=friendly+modificator|0;break;case 5:this.poisonAddiction=this.poisonAddiction+modificator|0;break;case 6:this.corpseAddiction=this.corpseAddiction+modificator|0}}return new TSS.UniverseLogic.Genome.ctor(hunger,aggression,reproduction,friendly,this.poisonAddiction,this.corpseAddiction)}});Bridge.define("TSS.UniverseLogic.MoveDirection",{$kind:"enum",statics:{stand:0,up:1,down:2,left:3,right:4}});Bridge.define("TSS.UniverseLogic.Universe",{totalUniverseEnergy:System.Int64(0),universeMatrix:null,poisonPlace:null,foodPlace:null,cellList:null,width:0,height:0,ticksCount:System.Int64(0),mostFitGenome_OneCell:null,constsUniverse:null,disposed:!1,invokedActions:null,typesOfCellsCount:0,config:{init:function(){this.cellList=new(System.Collections.Generic.List$1(TSS.UniverseLogic.Cell))(0);this.invokedActions=new(System.Collections.Generic.List$1(Function))}},ctor:function(width,height){this.$initialize();this.width=width;this.height=height;this.foodPlace=System.Array.create(!1,null,Boolean,width,height);this.poisonPlace=System.Array.create(!1,null,Boolean,width,height);this.setDefaultObjectsAccessiblePlace();this.setConstsUniverseProperty(new TSS.UniverseLogic.ConstsUniverse);this.universeMatrix=System.Array.create(null,null,TSS.UniverseLogic.UniverseObject,width,height);this.ticksCount=System.Int64(0)},getConstsUniverseProperty:function(){return this.constsUniverse},setConstsUniverseProperty:function(value){this.constsUniverse=value},getHeight:function(){return this.height},getWidth:function(){return this.width},getTypesOfCellsCount:function(){return this.typesOfCellsCount},setTypesOfCellsCount:function(value){this.typesOfCellsCount=value},dispose:function(){var i,j;for(this.disposed=!0,i=0;i<this.width;i=i+1|0)for(j=0;j<this.height;j=j+1|0)this.getMatrixElement(i,j).dispose();this.universeMatrix=null;this.poisonPlace=null;this.foodPlace=null;this.cellList=null;this.mostFitGenome_OneCell=null;this.constsUniverse=null;this.invokedActions=null},isDisposed:function(){return this.disposed},doUniverseTick:function(){var $t,act;if(!this.isDisposed()&&(this.checkAllCells(),this.handleAllCellsMoves(),this.generateFood(this.getConstsUniverseProperty().special_FoodCountForTick),this.generatePoison(this.getConstsUniverseProperty().special_PoisonCountForTick),this.calcMostFitCell(),this.ticksCount.mod(System.Int64(15)).equals(System.Int64(1))&&this.calcTotalUniverseEnergy(),this.ticksCount=this.ticksCount.inc(),this.invokedActions.getCount()>0))for($t=Bridge.getEnumerator(this.invokedActions.toArray());$t.moveNext();)act=$t.getCurrent(),act(),this.invokedActions.remove(act)},getObjectDescriptor:function(x,y){return this.validateCords(x,y)&&this.getMatrixElement(x,y)!=null?this.getMatrixElement(x,y).getDescriptor():0},getAllDescriptors:function(){for(var j,descriptors=System.Array.create(0,null,System.Int32,this.width,this.height),i=0;i<this.width;i=i+1|0)for(j=0;j<this.height;j=j+1|0)descriptors.set([i,j],this.getObjectDescriptor(i,j));return descriptors},getCellsCount:function(){return this.cellList.getCount()},getTicksCount:function(){return this.ticksCount},getMostFitCell:function(){return this.mostFitGenome_OneCell},getTotalUniverseEnergy:function(){return this.totalUniverseEnergy},getMatrixElement:function(x,y){return this.universeMatrix.get([x,y])},setDefaultObjectsAccessiblePlace:function(){for(var j,i=0;i<this.width;i=i+1|0)for(j=0;j<this.height;j=j+1|0)this.setFoodCanPlaceAt(i,j,!0),this.setPoisonCanPlaceAt(i,j,TSS.Another.StableRandom.rd.next$2(0,50)===1)},setFoodCanPlaceAt:function(x,y,value){this.validateCords(x,y)&&this.foodPlace.set([x,y],value)},getFoodCanPlaceAt:function(x,y){return this.foodPlace.get([x,y])},setPoisonCanPlaceAt:function(x,y,value){this.validateCords(x,y)&&this.poisonPlace.set([x,y],value)},getPoisonCanPlaceAt:function(x,y){return this.poisonPlace.get([x,y])},setAllPlaceOfFood:function(fieldDescription){if(System.Array.getLength(fieldDescription,0)!==this.width||System.Array.getLength(fieldDescription,1)!==this.height)throw new System.Exception("Field description size are not correct.");this.foodPlace=Bridge.as(System.Array.clone(fieldDescription),System.Array.type(Boolean,2))},getAllPlaceOfFood:function(){return Bridge.as(System.Array.clone(this.foodPlace),System.Array.type(Boolean,2))},setAllPlaceOfPoison:function(fieldDescription){if(System.Array.getLength(fieldDescription,0)!==this.width||System.Array.getLength(fieldDescription,1)!==this.height)throw new System.Exception("Field description size are not correct.");this.poisonPlace=Bridge.as(System.Array.clone(fieldDescription),System.Array.type(Boolean,2))},getAllPlaceOfPoison:function(){return Bridge.as(System.Array.clone(this.poisonPlace),System.Array.type(Boolean,2))},clearField:function(isAsync){isAsync===void 0&&(isAsync=!0);var act=Bridge.fn.bind(this,$asm.$.TSS.UniverseLogic.Universe.f1);isAsync?this.beginInvokeAction(act):act()},generateCells:function(count,isSync){isSync===void 0&&(isSync=!0);var act=Bridge.fn.bind(this,function(){for(var i=0;i<count;i=i+1|0){var x=TSS.Another.StableRandom.rd.next$1(this.width),y=TSS.Another.StableRandom.rd.next$1(this.height),cell=new TSS.UniverseLogic.Cell.ctor(this.getConstsUniverseProperty());this.addUniverseObject(x,y,cell,!0)&&(this.cellList.add(cell),this.setTypesOfCellsCount(this.getTypesOfCellsCount()+1|0))}});isSync?this.beginInvokeAction(act):act()},generateFoodOnAllField:function(isAsync){isAsync===void 0&&(isAsync=!0);this.clearField(isAsync);var act=Bridge.fn.bind(this,$asm.$.TSS.UniverseLogic.Universe.f2);isAsync?this.beginInvokeAction(act):act()},beginInvokeAction:function(action){this.invokedActions.add(action)},validateCords:function(x,y){return x>=0&&y>=0&&x<this.width&&y<this.height},setMatrixElement:function(x,y,universeObject){this.universeMatrix.set([x,y],universeObject);universeObject!=null&&universeObject.setCords(x,y)},addUniverseObject:function(x,y,universeObject,canReSetPrevObject){return this.getMatrixElement(x,y)==null?(this.setMatrixElement(x,y,universeObject),!0):canReSetPrevObject||this.getMatrixElement(x,y).isDisposed()?(this.getMatrixElement(x,y).dispose(),this.setMatrixElement(x,y,universeObject),!0):!1},relocateUniverseObject:function(x1,y1,x2,y2){this.setMatrixElement(x2,y2,this.getMatrixElement(x1,y1));this.setMatrixElement(x1,y1,null)},generateFood:function(count){for(var x,y,i=0;i<count;i=i+1|0)if(x=TSS.Another.StableRandom.rd.next$2(0,this.width),y=TSS.Another.StableRandom.rd.next$2(0,this.height),this.getFoodCanPlaceAt(x,y))if(this.getObjectDescriptor(x,y)>100)try{Bridge.as(this.getMatrixElement(x,y),TSS.UniverseLogic.Cell).addEnergy(this.getConstsUniverseProperty().energyLevel_DefFood)}catch($e1){$e1=System.Exception.create($e1)}else this.addUniverseObject(x,y,new TSS.UniverseLogic.Food(this.getConstsUniverseProperty(),TSS.UniverseLogic.FoodType.defaultFood),!0)},generatePoison:function(count){for(var x,y,i=0;i<count;i=i+1|0)if(x=TSS.Another.StableRandom.rd.next$2(0,this.width),y=TSS.Another.StableRandom.rd.next$2(0,this.height),this.getPoisonCanPlaceAt(x,y))if(this.getObjectDescriptor(x,y)>100)try{Bridge.as(this.getMatrixElement(x,y),TSS.UniverseLogic.Cell).addEnergy(this.getConstsUniverseProperty().energyLevel_PoisonedFood)}catch($e1){$e1=System.Exception.create($e1)}else this.addUniverseObject(x,y,new TSS.UniverseLogic.Food(this.getConstsUniverseProperty(),TSS.UniverseLogic.FoodType.poison),!0)},killCell:function(x,y){this.getMatrixElement(x,y).dispose();this.addUniverseObject(x,y,new TSS.UniverseLogic.Food(this.getConstsUniverseProperty(),TSS.UniverseLogic.FoodType.deadCell),!0)},handleCellMove:function(cell){var x1,y1,x2,y2,md,unObj,desc,anotherCell;if(!cell.isDisposed()){x1=cell.getX();y1=cell.getY();cell.calcMoveDirectionAspiration(this);md=cell.getMoveDisperation();switch(md){case TSS.UniverseLogic.MoveDirection.stand:return;case TSS.UniverseLogic.MoveDirection.up:x2=x1;y2=y1-1|0;break;case TSS.UniverseLogic.MoveDirection.down:x2=x1;y2=y1+1|0;break;case TSS.UniverseLogic.MoveDirection.left:x2=x1-1|0;y2=y1;break;case TSS.UniverseLogic.MoveDirection.right:x2=x1+1|0;y2=y1;break;default:return}this.validateCords(x2,y2)&&(unObj=this.getMatrixElement(x2,y2),unObj==null||unObj.isDisposed()?this.relocateUniverseObject(x1,y1,x2,y2):(desc=unObj.getDescriptor(),desc<0?(cell.addEnergy(Bridge.as(unObj,TSS.UniverseLogic.Food).getEnergyLevel()),this.relocateUniverseObject(x1,y1,x2,y2)):cell.getDescriptor()===desc?(cell.addEnergy(this.getConstsUniverseProperty().energyLevel_MovesFriendly),Bridge.as(unObj,TSS.UniverseLogic.Cell).addEnergy(this.getConstsUniverseProperty().energyLevel_MovesFriendly)):(anotherCell=Bridge.as(unObj,TSS.UniverseLogic.Cell),(this.getConstsUniverseProperty().mutation_AttackChildrenMutantsOfFirstGeneration||cell.getDescriptor()!==anotherCell.getParentDescriptor())&&(this.getConstsUniverseProperty().mutation_AttackParentIfCellIsYouMutant||cell.getParentDescriptor()!==anotherCell.getDescriptor())&&(cell.addEnergy(this.getConstsUniverseProperty().energyLevel_MovesAggression*.8),anotherCell.addEnergy(-this.getConstsUniverseProperty().energyLevel_MovesAggression)))))}},handleAllCellsMoves:function(){for(var cell,$t=Bridge.getEnumerator(this.cellList);$t.moveNext();)cell=$t.getCurrent(),this.handleCellMove(cell)},checkAllCells:function(){for(var notUniverseOverflow,choice,newCell,bufCellList2,index,cellCountWas=this.getCellsCount(),bufCellList=new(System.Collections.Generic.List$1(TSS.UniverseLogic.Cell))(0),i=0;i<this.cellList.getCount();i=i+1|0){if(this.cellList.getItem(i).isDisposed()){cellCountWas=cellCountWas-1|0;continue}else bufCellList.add(this.cellList.getItem(i));if(this.cellList.getItem(i).incAge()||this.cellList.getItem(i).decEnergy()){cellCountWas=cellCountWas-1|0;this.killCell(this.cellList.getItem(i).getX(),this.cellList.getItem(i).getY());this.cellList.getItem(i).getCellsCountWithThisDescriptor()<=0&&this.setTypesOfCellsCount(this.getTypesOfCellsCount()-1|0);continue}if(notUniverseOverflow=cellCountWas<=this.getConstsUniverseProperty().cellsCount_MaxAtField,notUniverseOverflow&&this.cellList.getItem(i).canReproduct()&&this.cellList.getItem(i).getCellsCountWithThisDescriptor()<this.getConstsUniverseProperty().cellsCount_MaxWithOneType){var md=new(System.Collections.Generic.List$1(TSS.UniverseLogic.MoveDirection))(0),x=this.cellList.getItem(i).getX(),y=this.cellList.getItem(i).getY();if(this.validateCords(x,y-1|0)&&this.getObjectDescriptor(x,y-1|0)<100&&md.add(TSS.UniverseLogic.MoveDirection.up),this.validateCords(x,y+1|0)&&this.getObjectDescriptor(x,y+1|0)<100&&md.add(TSS.UniverseLogic.MoveDirection.down),this.validateCords(x-1|0,y)&&this.getObjectDescriptor(x-1|0,y)<100&&md.add(TSS.UniverseLogic.MoveDirection.left),this.validateCords(x+1|0,y)&&this.getObjectDescriptor(x+1|0,y)<100&&md.add(TSS.UniverseLogic.MoveDirection.right),choice=TSS.UniverseLogic.MoveDirection.stand,md.getCount()>0&&(choice=md.getItem(TSS.Another.StableRandom.rd.next$1(md.getCount()))),choice===TSS.UniverseLogic.MoveDirection.stand)continue;newCell=this.cellList.getItem(i).createChild(this.getTypesOfCellsCount()<this.getConstsUniverseProperty().maxCountOfCellTypes);switch(choice){case TSS.UniverseLogic.MoveDirection.up:this.addUniverseObject(x,y-1|0,newCell,!0);break;case TSS.UniverseLogic.MoveDirection.down:this.addUniverseObject(x,y+1|0,newCell,!0);break;case TSS.UniverseLogic.MoveDirection.left:this.addUniverseObject(x-1|0,y,newCell,!0);break;case TSS.UniverseLogic.MoveDirection.right:this.addUniverseObject(x+1|0,y,newCell,!0)}bufCellList.add(newCell);newCell.getDescriptor()!==this.cellList.getItem(i).getDescriptor()&&this.setTypesOfCellsCount(this.getTypesOfCellsCount()+1|0);cellCountWas=cellCountWas+1|0}}if(this.ticksCount.mod(System.Int64(11)).equals(System.Int64(0)))for(bufCellList2=new(System.Collections.Generic.List$1(TSS.UniverseLogic.Cell))(0);bufCellList.getCount()>0;)index=TSS.Another.StableRandom.rd.next$1(bufCellList.getCount()),bufCellList2.add(bufCellList.getItem(index)),bufCellList.removeAt(index);else bufCellList2=bufCellList;this.cellList=bufCellList2},calcMostFitCell:function(){var $t,maxCount=0,cell=null,item,count;for(this.cellList.getCount()>0&&(cell=this.cellList.getItem(0)),$t=Bridge.getEnumerator(this.cellList);$t.moveNext();)item=$t.getCurrent(),count=item.getCellsCountWithThisDescriptor(),count>maxCount&&(maxCount=count,cell=item);this.mostFitGenome_OneCell=cell},calcTotalUniverseEnergy:function(){for(var j,uo,sum=System.Int64(0),i=0;i<this.width;i=i+1|0)for(j=0;j<this.height;j=j+1|0)uo=this.getMatrixElement(i,j),uo!=null&&!uo.isDisposed()&&Bridge.Reflection.isAssignableFrom(TSS.UniverseLogic.IHasEnergy,Bridge.getType(uo))&&(sum=sum.add(Bridge.Int.clip64(Bridge.as(uo,TSS.UniverseLogic.IHasEnergy).TSS$UniverseLogic$IHasEnergy$getEnergyLevel())));this.totalUniverseEnergy=sum}});Bridge.ns("TSS.UniverseLogic.Universe",$asm.$);Bridge.apply($asm.$.TSS.UniverseLogic.Universe,{f1:function(){this.cellList=new(System.Collections.Generic.List$1(TSS.UniverseLogic.Cell));this.mostFitGenome_OneCell=null;this.universeMatrix=System.Array.create(null,null,TSS.UniverseLogic.UniverseObject,this.width,this.height);this.setTypesOfCellsCount(0)},f2:function(){for(var j,i=0;i<this.width;i=i+1|0)for(j=0;j<this.height;j=j+1|0)this.setMatrixElement(i,j,new TSS.UniverseLogic.Food(this.getConstsUniverseProperty(),TSS.UniverseLogic.FoodType.defaultFood))}});Bridge.define("TSS.UniverseLogic.Cell",{inherits:[TSS.UniverseLogic.UniverseObject,TSS.UniverseLogic.IHasEnergy],age:0,energyLevel:0,genome:null,moveDisperation:0,parentDescriptor:0,cellsWithThisDescriptorCount:null,config:{alias:["getEnergyLevel","TSS$UniverseLogic$IHasEnergy$getEnergyLevel","dispose","System$IDisposable$dispose"],init:function(){this.cellsWithThisDescriptorCount=new TSS.UniverseLogic.Cell.LinkedInt}},ctor:function(constsUniverse){TSS.UniverseLogic.Cell.$ctor1.call(this,constsUniverse,new TSS.UniverseLogic.Genome.$ctor1(constsUniverse),constsUniverse.energyLevel_CreatingCell,1)},$ctor1:function(constsUniverse,genome,energyLevel,descriptor){if(this.$initialize(),TSS.UniverseLogic.UniverseObject.ctor.call(this,constsUniverse),this.genome=genome,this.age=0,this.energyLevel=energyLevel,descriptor<100){var desc=TSS.Another.StableRandom.rd.next$2(100,2147483647);this.descriptor=desc}else this.descriptor=descriptor;this.parentDescriptor=TSS.Another.StableRandom.rd.next$2(100,2147483647)},getGenome:function(){return this.genome},getMoveDisperation:function(){return this.moveDisperation},getEnergyLevel:function(){return this.energyLevel},addEnergy:function(value){this.energyLevel+=value;this.energyLevel>this.getConstsUniverseProperty().energyLevel_MaxForCell&&(this.energyLevel=this.getConstsUniverseProperty().energyLevel_MaxForCell)},incAge:function(){return Bridge.identity(this.age,this.age=this.age+1|0)>this.getConstsUniverseProperty().cellAge_Max},decEnergy:function(){return this.energyLevel-=this.getConstsUniverseProperty().energyEntropyPerSecond,this.energyLevel<0},getAge:function(){return this.age},createChild:function(haveMutationChance){this.age=0;this.energyLevel=Bridge.Int.clip32(this.energyLevel/2);var res;return haveMutationChance&&TSS.Another.StableRandom.rd.next$1(100)<this.getConstsUniverseProperty().mutation_ChancePercent&&this.getConstsUniverseProperty().mutation_Enable?(res=new TSS.UniverseLogic.Cell.$ctor1(this.getConstsUniverseProperty(),this.genome.cloneAndMutate(this.getConstsUniverseProperty().mutation_ChangedValuesAtOne),this.getEnergyLevel(),1),res.parentDescriptor=this.descriptor):(res=new TSS.UniverseLogic.Cell.$ctor1(this.getConstsUniverseProperty(),this.genome.clone(),this.getEnergyLevel(),this.descriptor),res.cellsWithThisDescriptorCount=this.cellsWithThisDescriptorCount,this.cellsWithThisDescriptorCount.value=this.cellsWithThisDescriptorCount.value+1|0,res.parentDescriptor=this.parentDescriptor),res},calcMoveDirectionAspiration:function(universe){var a0=universe.getObjectDescriptor(this.x-1|0,this.y),a1=universe.getObjectDescriptor(this.x,this.y-1|0),a2=universe.getObjectDescriptor(this.x,this.y+1|0),a3=universe.getObjectDescriptor(this.x+1|0,this.y),b0=universe.getObjectDescriptor(this.x-2|0,this.y),b1=universe.getObjectDescriptor(this.x-1|0,this.y-1|0),b2=universe.getObjectDescriptor(this.x-1|0,this.y+1|0),b3=universe.getObjectDescriptor(this.x,this.y-2|0),b4=universe.getObjectDescriptor(this.x,this.y+2|0),b5=universe.getObjectDescriptor(this.x+1|0,this.y-1|0),b6=universe.getObjectDescriptor(this.x+1|0,this.y+1|0),b7=universe.getObjectDescriptor(this.x+2|0,this.y),q0=universe.getObjectDescriptor(this.x-2|0,this.y-1|0),q1=universe.getObjectDescriptor(this.x-2|0,this.y+1|0),q2=universe.getObjectDescriptor(this.x-1|0,this.y-2|0),q3=universe.getObjectDescriptor(this.x-1|0,this.y+2|0),q4=universe.getObjectDescriptor(this.x+1|0,this.y-2|0),q5=universe.getObjectDescriptor(this.x+1|0,this.y+2|0),q6=universe.getObjectDescriptor(this.x+2|0,this.y-1|0),q7=universe.getObjectDescriptor(this.x+2|0,this.y+1|0),ad_a0=this.analizeDescriptor(a0),ad_a1=this.analizeDescriptor(a1),ad_a2=this.analizeDescriptor(a2),ad_a3=this.analizeDescriptor(a3),ad_b0=this.analizeDescriptor(b1),ad_b1=this.analizeDescriptor(b1),ad_b2=this.analizeDescriptor(b2),ad_b3=this.analizeDescriptor(b3),ad_b4=this.analizeDescriptor(b4),ad_b5=this.analizeDescriptor(b5),ad_b6=this.analizeDescriptor(b6),ad_b7=this.analizeDescriptor(b7),ad_q0=this.analizeDescriptor(q0),ad_q1=this.analizeDescriptor(q1),ad_q2=this.analizeDescriptor(q2),ad_q3=this.analizeDescriptor(q3),ad_q4=this.analizeDescriptor(q4),ad_q5=this.analizeDescriptor(q5),ad_q6=this.analizeDescriptor(q6),ad_q7=this.analizeDescriptor(q7),up,down,left,right,biggest,res,md;up=ad_q2+ad_q4+2*(ad_b1+ad_b3+ad_b5)+3*ad_a1;down=ad_q3+ad_q5+2*(ad_b2+ad_b4+ad_b6)+3*ad_a2;left=ad_q0+ad_q1+2*(ad_b0+ad_b1+ad_b2)+3*ad_a0;right=ad_q6+ad_q7+2*(ad_b5+ad_b6+ad_b7)+3*ad_a3;biggest=up;down>biggest&&(biggest=down);left>biggest&&(biggest=left);right>biggest&&(biggest=right);res=TSS.UniverseLogic.MoveDirection.stand;biggest>=0&&(md=new(System.Collections.Generic.List$1(TSS.UniverseLogic.MoveDirection))(0),biggest===up&&md.add(TSS.UniverseLogic.MoveDirection.up),biggest===down&&md.add(TSS.UniverseLogic.MoveDirection.down),biggest===left&&md.add(TSS.UniverseLogic.MoveDirection.left),biggest===right&&md.add(TSS.UniverseLogic.MoveDirection.right),res=md.getItem(TSS.Another.StableRandom.rd.next$1(md.getCount())));this.moveDisperation=res},canReproduct:function(){return this.getEnergyLevel()>=this.getConstsUniverseProperty().energyLevel_NeededForReproduction-this.genome.getReproduction()*this.getConstsUniverseProperty().energyLevel_NeededForReproduction/200&&this.isAdult()},dispose:function(){this.isDisposed()||(this.cellsWithThisDescriptorCount.value=this.cellsWithThisDescriptorCount.value-1|0);TSS.UniverseLogic.UniverseObject.prototype.dispose.call(this);this.genome=null},getCellsCountWithThisDescriptor:function(){return this.cellsWithThisDescriptorCount.value},getParentDescriptor:function(){return this.parentDescriptor},isAdult:function(){return this.getAge()>=this.getConstsUniverseProperty().cellAge_AdultCell},analizeDescriptor:function(desc){return desc===0?0:desc===this.descriptor?this.genome.getFriendly():desc<0?desc===-3?this.genome.getPoisonAddiction():desc===-2?this.genome.getCorpseAddiction():this.genome.getHunger():this.isAdult()?this.genome.getAggression():this.getConstsUniverseProperty().cellGenome_Child_Aggression}});Bridge.define("TSS.UniverseLogic.Food",{inherits:[TSS.UniverseLogic.UniverseObject,TSS.UniverseLogic.IHasEnergy],getEnergyLevelDelegate:null,config:{alias:["getEnergyLevel","TSS$UniverseLogic$IHasEnergy$getEnergyLevel"]},ctor:function(constsUniverse,foodType){this.$initialize();TSS.UniverseLogic.UniverseObject.ctor.call(this,constsUniverse);foodType===TSS.UniverseLogic.FoodType.defaultFood?(this.descriptor=-1,this.getEnergyLevelDelegate=Bridge.fn.bind(this,$asm.$.TSS.UniverseLogic.Food.f1)):foodType===TSS.UniverseLogic.FoodType.deadCell?(this.descriptor=-2,this.getEnergyLevelDelegate=Bridge.fn.bind(this,$asm.$.TSS.UniverseLogic.Food.f2)):foodType===TSS.UniverseLogic.FoodType.poison&&(this.descriptor=-3,this.getEnergyLevelDelegate=Bridge.fn.bind(this,$asm.$.TSS.UniverseLogic.Food.f3))},getEnergyLevel:function(){return this.getEnergyLevelDelegate()}});Bridge.ns("TSS.UniverseLogic.Food",$asm.$);Bridge.apply($asm.$.TSS.UniverseLogic.Food,{f1:function(){return this.getConstsUniverseProperty().energyLevel_DefFood},f2:function(){return this.getConstsUniverseProperty().energyLevel_DeadCell},f3:function(){return this.getConstsUniverseProperty().energyLevel_PoisonedFood}});var $m=Bridge.setMetadata,$n=[System,TSS.Helpers,TSS.UniverseLogic];$m($n[1].MinMaxInt,function(){return{at:[new TSS.Helpers.ParsebleAttribute]}});$m($n[2].ConstsUniverse,function(){return{m:[{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-2147483648,2147483647)],a:2,n:"CellAge_AdultCell",t:4,rt:$n[0].Int32,sn:"cellAge_AdultCell"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-2147483648,2147483647)],a:2,n:"CellAge_Max",t:4,rt:$n[0].Int32,sn:"cellAge_Max"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-2147483648,2147483647)],a:2,n:"CellGenome_Child_Aggression",t:4,rt:$n[0].Int32,sn:"cellGenome_Child_Aggression"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-2147483648,2147483647)],a:2,n:"CellsCount_MaxAtField",t:4,rt:$n[0].Int32,sn:"cellsCount_MaxAtField"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-2147483648,2147483647)],a:2,n:"CellsCount_MaxWithOneType",t:4,rt:$n[0].Int32,sn:"cellsCount_MaxWithOneType"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-99999,99999)],a:2,n:"EnergyEntropyPerSecond",t:4,rt:$n[0].Single,sn:"energyEntropyPerSecond"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-34028234663852886e22,34028234663852886e22)],a:2,n:"EnergyLevel_CreatingCell",t:4,rt:$n[0].Single,sn:"energyLevel_CreatingCell"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-34028234663852886e22,34028234663852886e22)],a:2,n:"EnergyLevel_DeadCell",t:4,rt:$n[0].Single,sn:"energyLevel_DeadCell"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-34028234663852886e22,34028234663852886e22)],a:2,n:"EnergyLevel_DefFood",t:4,rt:$n[0].Single,sn:"energyLevel_DefFood"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-34028234663852886e22,34028234663852886e22)],a:2,n:"EnergyLevel_MaxForCell",t:4,rt:$n[0].Single,sn:"energyLevel_MaxForCell"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-34028234663852886e22,34028234663852886e22)],a:2,n:"EnergyLevel_MovesAggression",t:4,rt:$n[0].Single,sn:"energyLevel_MovesAggression"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-34028234663852886e22,34028234663852886e22)],a:2,n:"EnergyLevel_MovesFriendly",t:4,rt:$n[0].Single,sn:"energyLevel_MovesFriendly"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-34028234663852886e22,34028234663852886e22)],a:2,n:"EnergyLevel_NeededForReproduction",t:4,rt:$n[0].Single,sn:"energyLevel_NeededForReproduction"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(-34028234663852886e22,34028234663852886e22)],a:2,n:"EnergyLevel_PoisonedFood",t:4,rt:$n[0].Single,sn:"energyLevel_PoisonedFood"},{at:[new TSS.Helpers.NumericValuesAttribute.$ctor1(0,100,1)],a:2,n:"Mutation_ChancePercent",t:4,rt:$n[0].Int32,sn:"mutation_ChancePercent"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(1,200)],a:2,n:"Mutation_ChangedValuesAtOne",t:4,rt:$n[0].Int32,sn:"mutation_ChangedValuesAtOne"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(0,3e4)],a:2,n:"Special_FoodCountForTick",t:4,rt:$n[0].Int32,sn:"special_FoodCountForTick"},{at:[new TSS.Helpers.NumericValuesAttribute.ctor(0,3e4)],a:2,n:"Special_PoisonCountForTick",t:4,rt:$n[0].Int32,sn:"special_PoisonCountForTick"}]}})});